USE [QLX]
GO
/****** Object:  StoredProcedure [dbo].[updateUser_customer]    Script Date: 1/3/2024 7:18:46 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[updateUser_customer]
@userID INT, @userName VARCHAR(255), @ngay_sinh DATETIME, @sex VARCHAR(10), @city VARCHAR(50), @contact_num VARCHAR(50)
AS
BEGIN
	UPDATE dbo.info
	SET name = @userName, Birth = @ngay_sinh, sex = @sex, City = @city, contact_number = @contact_num
	WHERE user_id = @userID
END



GO
/****** Object:  StoredProcedure [dbo].[USP_Change_Info]    Script Date: 1/3/2024 7:19:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_Change_Info]
@userID INT, @Birth DATE, @Name VARCHAR(255), @sex VARCHAR(10), @city NVARCHAR(50), @SDT VARCHAR(50), @CCCD VARCHAR(20)
AS
BEGIN
	UPDATE dbo.info SET
	name = @Name,
	Birth = @Birth,
	City = @city,
	contact_number = @SDT,
	sex = @sex,
	CCCD = @CCCD
	WHERE user_id = @userID
END




GO
/****** Object:  StoredProcedure [dbo].[USP_INFO]    Script Date: 1/3/2024 7:19:18 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_INFO]
@userID INT
AS
BEGIN
	SELECT
	users.password as Password,
    users.user_id as Mã_người_dùng,
    users.username as Tên_đăng_nhập,
    info.name as Tên,
    info.Birth as Ngày_sinh,
    info.Age as Tuổi,
    info.City as Thành_phố,
    info.contact_number as SDT,
    info.sex as Giới_tính,
    info.CCCD,
    permissions.role_name as Mã_chức_vụ
	FROM 
		dbo.info
	INNER JOIN 
		dbo.permissions ON info.role_id = permissions.role_id
	INNER JOIN 
		users ON info.user_id = users.user_id
	WHERE 
		dbo.info.user_id = @userID;
END



GO
/****** Object:  StoredProcedure [dbo].[USP_Login]    Script Date: 1/3/2024 7:19:27 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROC [dbo].[USP_Login]
@userName varchar(255), @passWord varchar(255)
AS
BEGIN
	SELECT * FROM dbo.users WHERE username = @userName AND password = @passWord
END




GO
/****** Object:  StoredProcedure [dbo].[USP_UpdatePassword]    Script Date: 1/3/2024 7:19:34 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_UpdatePassword]
@userName VARCHAR(255), @password VARCHAR(255), @newpassword VARCHAR(255)
AS
BEGIN
	DECLARE @isRightPass INT = 0
	
	SELECT @isRightPass = COUNT(*) FROM dbo.users WHERE username = @userName AND password = @password
	
	IF (@isRightPass = 1)
	BEGIN
		UPDATE users SET password = @newpassword WHERE username = @userName AND password = @password
	END
END